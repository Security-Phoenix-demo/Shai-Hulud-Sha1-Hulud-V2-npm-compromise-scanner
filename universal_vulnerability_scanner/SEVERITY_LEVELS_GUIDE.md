# ðŸ“Š Severity Levels Guide - Universal Vulnerability Scanner

## Overview

The Universal Vulnerability Scanner uses a **two-tier severity system** aligned with the Phoenix Security platform:

1. **Severity 10 (CRITICAL)** - For vulnerable packages requiring immediate action
2. **Severity 1 (INFO)** - For safe/clean packages (informational only)

---

## ðŸŽ¯ Severity Level Definitions

### Severity 10 - CRITICAL (Phoenix Score: 10.0/10.0)

**Used for**: ðŸš¨ **VULNERABLE** packages

**Criteria**:
- Package version matches **exact vulnerable version** in database
- Package version falls within a **vulnerable range** in database
- Confirmed exploitable vulnerability (CVE-2025-66478)

**Examples**:
```
ðŸš¨ react@19.0.0 â†’ Severity 10 (CRITICAL)
ðŸš¨ react@19.1.0 â†’ Severity 10 (CRITICAL)
ðŸš¨ next@15.0.3 â†’ Severity 10 (CRITICAL)
ðŸš¨ react-server-dom-webpack@19.2.0 â†’ Severity 10 (CRITICAL)
```

**Action Required**: âš ï¸ **IMMEDIATE UPGRADE**

**Phoenix Mapping**:
```json
{
  "severity": "10.0",
  "risk_level": "CRITICAL",
  "action": "IMMEDIATE"
}
```

---

### Severity 1 - INFO (Phoenix Score: 1.0/10.0)

**Used for**: âœ… **SAFE** and **CLEAN** packages

**Criteria**:

#### 1. SAFE Packages (Severity 1)
- Package **is in vulnerability database**
- Version is **NOT vulnerable** (patched/fixed version)
- Package is being monitored for CVE-2025-66478

**Examples**:
```
âœ… react@19.0.1 â†’ Severity 1 (INFO) - Safe patched version
âœ… react@19.1.2 â†’ Severity 1 (INFO) - Safe patched version
âœ… next@16.0.7 â†’ Severity 1 (INFO) - Safe patched version
âœ… react-server-dom-webpack@19.2.1 â†’ Severity 1 (INFO) - Safe patched version
```

#### 2. CLEAN Packages (Severity 1)
- Package **is NOT in vulnerability database**
- Not monitored for CVE-2025-66478
- No known vulnerabilities in this scanner

**Examples**:
```
âœ… express@4.18.2 â†’ Severity 1 (INFO) - Not monitored
âœ… lodash@4.17.21 â†’ Severity 1 (INFO) - Not monitored
âœ… axios@1.6.0 â†’ Severity 1 (INFO) - Not monitored
âœ… typescript@5.3.0 â†’ Severity 1 (INFO) - Not monitored
```

**Action Required**: âœ… **No action needed** (informational only)

**Phoenix Mapping**:
```json
{
  "severity": "1.0",
  "risk_level": "INFO",
  "action": "NONE"
}
```

---

## ðŸ“‹ Complete Severity Mapping

| Verdict | Severity | Phoenix Score | Risk Level | Action | Use Case |
|---------|----------|---------------|------------|--------|----------|
| VULNERABLE | 10 (CRITICAL) | 10.0 | CRITICAL | IMMEDIATE | Confirmed vulnerable version |
| SAFE | 1 (INFO) | 1.0 | INFO | NONE | Safe version of monitored package |
| CLEAN | 1 (INFO) | 1.0 | INFO | NONE | Package not in database |
| REVIEW | 3.5 (LOW) | 3.5 | LOW | REVIEW | Parse errors, manual check needed |

---

## ðŸ§ª Test Sample: Clean Safe Versions

### Location
```
universal_vulnerability_scanner/test_samples/clean_safe_versions/
```

### Purpose
Demonstrates **Severity 1 (INFO)** assignment for:
- Safe/patched versions of monitored packages
- Clean packages not in vulnerability database

### Package List

#### Safe Versions (Severity 1) - 6 packages:
```json
{
  "react": "19.0.1",                      // âœ… Fixed version
  "react-dom": "19.1.2",                  // âœ… Fixed version
  "react-server-dom-webpack": "19.2.1",   // âœ… Fixed version
  "react-server-dom-parcel": "19.0.1",    // âœ… Fixed version
  "react-server-dom-turbopack": "19.1.2", // âœ… Fixed version
  "next": "16.0.7"                        // âœ… Fixed version
}
```

#### Clean Packages (Severity 1) - 7 packages:
```json
{
  "express": "4.18.2",        // âœ… Not monitored
  "lodash": "4.17.21",        // âœ… Not monitored
  "axios": "1.6.0",           // âœ… Not monitored
  "@types/react": "18.2.0",   // âœ… Not monitored
  "@types/react-dom": "18.2.0", // âœ… Not monitored
  "typescript": "5.3.0",      // âœ… Not monitored
  "jest": "29.7.0"            // âœ… Not monitored
}
```

### Expected Scan Results

```bash
$ python -m universal_vulnerability_scanner.main scan test_samples/clean_safe_versions/

SUMMARY:
  VULNERABLE:  0  â† No critical issues
  SAFE:        12 â† Monitored packages with safe versions (Severity 1)
  CLEAN:       15 â† Packages not in database (Severity 1)

SEVERITY BREAKDOWN:
  CRITICAL: 0   â† No severity 10
  INFO:     27  â† All findings are severity 1
```

---

## ðŸ” Severity Assignment Logic

### Code Implementation

From `models/finding.py`:

```python
class Severity(Enum):
    """Severity levels aligned with Phoenix Security platform."""
    CRITICAL = "CRITICAL"  # 10.0 - Confirmed exploit
    HIGH = "HIGH"          # 8.0 - Potentially compromised
    MEDIUM = "MEDIUM"      # 6.0 - Suspicious
    LOW = "LOW"            # 3.5 - Low risk
    INFO = "INFO"          # 1.0 - Informational

def to_phoenix_format(self) -> Dict[str, Any]:
    """Convert finding to Phoenix Security platform format."""
    severity_map = {
        Severity.CRITICAL: 10.0,  # Vulnerable packages
        Severity.HIGH: 8.0,
        Severity.MEDIUM: 6.0,
        Severity.LOW: 3.5,
        Severity.INFO: 1.0        # Safe/Clean packages
    }
    
    phoenix_severity = severity_map.get(self.severity, 5.0)
    
    return {
        "severity": f"{phoenix_severity:.1f}",
        # ... other fields
    }
```

### Scanner Logic

From `scanners/npm_scanner.py`:

```python
def check_vulnerability(self, package: str, version: str, path: str, kind: str) -> Optional[Finding]:
    """Check if package@version is vulnerable."""
    
    vuln = self.vulnerabilities.get(package)
    
    if not vuln:
        # Package not in database â†’ CLEAN, Severity 1
        return Finding(
            path=path,
            kind=kind,
            package=package,
            version=version,
            verdict=Verdict.CLEAN,
            severity=Severity.INFO,  # â† Severity 1
            reason="Package not in vulnerability database"
        )
    
    # Check if version is vulnerable
    if is_vulnerable:
        # Vulnerable version â†’ VULNERABLE, Severity 10
        return Finding(
            verdict=Verdict.VULNERABLE,
            severity=Severity.CRITICAL,  # â† Severity 10
            # ...
        )
    else:
        # Safe version of monitored package â†’ SAFE, Severity 1
        return Finding(
            verdict=Verdict.SAFE,
            severity=Severity.INFO,  # â† Severity 1
            # ...
        )
```

---

## ðŸ“Š JSON Output Format

### Vulnerable Package (Severity 10):
```json
{
  "package": "react",
  "version": "19.0.0",
  "verdict": "VULNERABLE",
  "severity": "CRITICAL",
  "severity_score": 10.0,
  "reason": "Exact match with known vulnerable version 19.0.0",
  "safe_version": "19.0.1",
  "cve_ids": ["CVE-2025-66478"],
  "phoenix_format": {
    "severity": "10.0",
    "description": "VULNERABLE: react@19.0.0 - ...",
    "remedy": "ðŸš¨ CRITICAL: Upgrade react to safe version 19.0.1 or later"
  }
}
```

### Safe Package (Severity 1):
```json
{
  "package": "react",
  "version": "19.0.1",
  "verdict": "SAFE",
  "severity": "INFO",
  "severity_score": 1.0,
  "reason": "Safe version of monitored package",
  "vulnerable_versions": ["19.0.0", "19.1.0", "19.1.1", "19.2.0"],
  "cve_ids": ["CVE-2025-66478"],
  "phoenix_format": {
    "severity": "1.0",
    "description": "SAFE: react@19.0.1 is a safe version",
    "remedy": "âœ… No action required. react@19.0.1 is not vulnerable."
  }
}
```

### Clean Package (Severity 1):
```json
{
  "package": "express",
  "version": "4.18.2",
  "verdict": "CLEAN",
  "severity": "INFO",
  "severity_score": 1.0,
  "reason": "Package not in vulnerability database",
  "phoenix_format": {
    "severity": "1.0",
    "description": "CLEAN: express@4.18.2 not in vulnerability database",
    "remedy": "âœ… No action required. express@4.18.2 is not vulnerable."
  }
}
```

---

## ðŸŽ¯ Use Cases by Severity

### Severity 10 (CRITICAL) Use Cases:

1. **CI/CD Pipeline Failure**
   ```bash
   # Fail build if CRITICAL findings exist
   python -m universal_vulnerability_scanner.main scan . --json -o scan.json
   if jq -e '.findings[] | select(.severity == "CRITICAL")' scan.json; then
       echo "âŒ Build failed: Critical vulnerabilities found"
       exit 1
   fi
   ```

2. **Immediate Alerts**
   ```bash
   # Send alert for CRITICAL only
   CRITICAL_COUNT=$(jq '[.findings[] | select(.severity == "CRITICAL")] | length' scan.json)
   if [ "$CRITICAL_COUNT" -gt 0 ]; then
       curl -X POST $SLACK_WEBHOOK -d "{\"text\": \"ðŸš¨ $CRITICAL_COUNT critical vulnerabilities found!\"}"
   fi
   ```

3. **Phoenix Upload (CRITICAL only)**
   ```bash
   # Upload only CRITICAL findings to Phoenix
   python -m universal_vulnerability_scanner.main scan . \
       --upload-phoenix \
       --filter-severity CRITICAL
   ```

### Severity 1 (INFO) Use Cases:

1. **Audit Trail**
   ```bash
   # Log all scanned packages (including safe ones)
   python -m universal_vulnerability_scanner.main scan . --json -o audit.json
   # All packages logged with severity 1 or 10
   ```

2. **Compliance Reporting**
   ```bash
   # Generate report showing all packages scanned
   # Safe packages (severity 1) prove due diligence
   python -m universal_vulnerability_scanner.main scan . --html -o compliance-report.html
   ```

3. **Monitoring Dashboard**
   ```bash
   # Track safe versions over time
   # Severity 1 findings show packages are being monitored
   jq '[.findings[] | select(.severity == "INFO" and .verdict == "SAFE")]' scan.json
   ```

---

## ðŸ”„ Severity Changes Over Time

### Scenario: Package Gets Patched

**Before Patch** (Vulnerable):
```json
{
  "package": "react",
  "version": "19.0.0",
  "severity": "CRITICAL",  // Severity 10
  "verdict": "VULNERABLE"
}
```

**After Upgrade** (Safe):
```json
{
  "package": "react",
  "version": "19.0.1",
  "severity": "INFO",      // Severity 1
  "verdict": "SAFE"
}
```

### Scenario: New Vulnerability Discovered

**Before CVE** (Clean):
```json
{
  "package": "some-package",
  "version": "1.0.0",
  "severity": "INFO",      // Severity 1
  "verdict": "CLEAN"       // Not in database
}
```

**After CVE Added to Database** (Vulnerable):
```json
{
  "package": "some-package",
  "version": "1.0.0",
  "severity": "CRITICAL",  // Severity 10
  "verdict": "VULNERABLE"  // Now in database
}
```

---

## ðŸ“ˆ Reporting Examples

### Summary Report with Severity Breakdown:

```
SUMMARY:
----------------------------------------
Total findings: 45
  VULNERABLE:  3   â† Severity 10 (CRITICAL)
  SAFE:        12  â† Severity 1 (INFO)
  CLEAN:       30  â† Severity 1 (INFO)

SEVERITY BREAKDOWN:
----------------------------------------
  CRITICAL: 3   â† Requires immediate action
  INFO:     42  â† Informational only

Risk Assessment:
  ðŸ”´ High Risk: 3 packages (6.7%)
  ðŸŸ¢ No Risk: 42 packages (93.3%)
```

### Phoenix Dashboard View:

```
Critical Findings (Severity 10.0):
  ðŸš¨ react@19.0.0 in package.json
  ðŸš¨ next@15.0.3 in package.json
  ðŸš¨ react-server-dom-webpack@19.1.0 in package-lock.json

Informational (Severity 1.0):
  âœ… react@19.0.1 (safe version)
  âœ… express@4.18.2 (not monitored)
  âœ… lodash@4.17.21 (not monitored)
  ... (39 more)
```

---

## âœ… Verification Commands

### Test Severity Assignment:

```bash
# Scan clean/safe versions (should show only Severity 1)
python -m universal_vulnerability_scanner.main scan test_samples/clean_safe_versions/

# Expected: CRITICAL: 0, INFO: 27

# Scan vulnerable versions (should show Severity 10)
python -m universal_vulnerability_scanner.main scan test_samples/rsc_vulnerable_exact/

# Expected: CRITICAL: 4, INFO: 0
```

### Verify JSON Output:

```bash
# Check severity values in JSON
python -m universal_vulnerability_scanner.main scan test_samples/clean_safe_versions/ \
    --json --output clean.json

jq '.findings[] | {package, version, severity, severity_score}' clean.json

# Expected output:
# {
#   "package": "react",
#   "version": "19.0.1",
#   "severity": "INFO",
#   "severity_score": 1.0
# }
```

### Verify Phoenix Format:

```bash
# Check Phoenix severity mapping
jq '.findings[0].phoenix_format.severity' clean.json

# Expected: "1.0" for safe/clean packages
# Expected: "10.0" for vulnerable packages
```

---

## ðŸŽ“ Best Practices

### 1. Filter by Severity in CI/CD
```bash
# Only fail on CRITICAL (severity 10)
if [ $(jq '[.findings[] | select(.severity == "CRITICAL")] | length' scan.json) -gt 0 ]; then
    exit 1
fi
```

### 2. Separate Reporting
```bash
# Critical findings report
jq '[.findings[] | select(.severity == "CRITICAL")]' scan.json > critical.json

# Informational report
jq '[.findings[] | select(.severity == "INFO")]' scan.json > info.json
```

### 3. Phoenix Upload Strategy
```bash
# Upload CRITICAL immediately
python -m universal_vulnerability_scanner.main scan . \
    --upload-phoenix \
    --filter-severity CRITICAL

# Upload INFO for audit trail (optional)
python -m universal_vulnerability_scanner.main scan . \
    --upload-phoenix \
    --include-info
```

---

## ðŸ“š Summary

| Aspect | Severity 10 (CRITICAL) | Severity 1 (INFO) |
|--------|----------------------|-------------------|
| **Verdict** | VULNERABLE | SAFE, CLEAN |
| **Phoenix Score** | 10.0/10.0 | 1.0/10.0 |
| **Risk Level** | CRITICAL | INFO |
| **Action** | IMMEDIATE UPGRADE | No action needed |
| **CI/CD** | Fail build | Pass (informational) |
| **Alerts** | Send immediately | Log only |
| **Phoenix** | Upload as critical | Upload for audit |
| **Count in Test** | 0 (clean sample) | 27 (all safe/clean) |

---

**âœ… Severity 1 (INFO) is correctly assigned to all safe and clean packages!**

**Test Sample**: `test_samples/clean_safe_versions/`  
**Verified**: December 4, 2025  
**Status**: âœ… Working as designed


